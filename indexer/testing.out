gcc -Wall -pedantic -std=c11 -ggdb  -IIBS indexer.o ../common/pagedir.o ../common/index.o ../common/word.o ../libcs50/libcs50-given.a ../common/common.a -o indexer
gcc -Wall -pedantic -std=c11 -ggdb  -IIBS indextest.o ../common/pagedir.o ../common/index.o ../common/word.o ../libcs50/libcs50-given.a ../common/common.a -o indextest
bash -v testing.sh
module () {  local _mlredir=1;
 if [ -n "${MODULES_REDIRECT_OUTPUT+x}" ]; then
 if [ "$MODULES_REDIRECT_OUTPUT" = '0' ]; then
 _mlredir=0;
 else
 if [ "$MODULES_REDIRECT_OUTPUT" = '1' ]; then
 _mlredir=1;
 fi;
 fi;
 fi;
 case " $@ " in 
 *' --no-redirect '*)
 _mlredir=0
 ;;
 *' --redirect '*)
 _mlredir=1
 ;;
 esac;
 if [ $_mlredir -eq 0 ]; then
 _module_raw "$@";
 else
 _module_raw "$@" 2>&1;
 fi
}
ml () {  module ml "$@"
}
_module_raw () {  eval "$(/usr/bin/tclsh8.6 '/usr/lib/x86_64-linux-gnu/modulecmd.tcl' bash "$@")";
 _mlstatus=$?;
 return $_mlstatus
}
# 0. Setup 

# create index and indextest files for each directory
touch ../data/letters.index ../data/letters.indextest
touch ../data/scrape.index ../data/scrape.indextest
touch ../data/wiki.index ../data/wiki.indextest

# create directory for files to test permissions
mkdir -p ../data/testfiles

# create non-readable pageDirectory 
touch ../data/testfiles/noreaddirectory
# removes read permissions
chmod -r ../data/testfiles/noreaddirectory

# create non-writeable index file
touch ../data/testfiles/nowriteindex
# removes write permissions 
chmod -w ../data/testfiles/nowriteindex


# 1. Erroneous arguments for indexer

# too few arguments (1)
./indexer
No arguments were given. The correct format is: indexer pageDirectory indexFilename

# too many arguments (6)
./indexer ../data/letters ../data/letters.index extraArg1 extraArg2 extraArg3
Too many arguments were given. The correct format is: indexer pageDirectory indexFilename

# bad pageDirectory
./indexer iufhkcsjdns ../data/letters.index
Error validating pageDirectory (argv1). The directory either does not exist, or is not crawler-produced.

# non crawler-produced pageDirectory
./indexer ../data ..data/letters.index
Error validating pageDirectory (argv1). The directory either does not exist, or is not crawler-produced.

# non-readable pageDirectory
./indexer ../data/testfiles/noreaddirectory ../data/letters.index
Error validating pageDirectory (argv1). The directory either does not exist, or is not crawler-produced.

# non-writable indexFilename
./indexer ../data/letters ../data/testfiles/nowriteindex
Provided indexFilename is not a valid file or does not have write permissions (argv2).


# 2. indexer and indextest
# ran with valgrind, passes all checks 
valgrind --leak-check=full --show-leak-kinds=all ./indexer ../data/letters ../data/letters.index
==806362== Memcheck, a memory error detector
==806362== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.
==806362== Using Valgrind-3.22.0 and LibVEX; rerun with -h for copyright info
==806362== Command: ./indexer ../data/letters ../data/letters.index
==806362== 
==806362== 
==806362== HEAP SUMMARY:
==806362==     in use at exit: 0 bytes in 0 blocks
==806362==   total heap usage: 1,606 allocs, 1,606 frees, 214,222 bytes allocated
==806362== 
==806362== All heap blocks were freed -- no leaks are possible
==806362== 
==806362== For lists of detected and suppressed errors, rerun with: -s
==806362== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
valgrind --leak-check=full --show-leak-kinds=all ./indextest ../data/letters.index ../data/letters.indextest
==806373== Memcheck, a memory error detector
==806373== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.
==806373== Using Valgrind-3.22.0 and LibVEX; rerun with -h for copyright info
==806373== Command: ./indextest ../data/letters.index ../data/letters.indextest
==806373== 
==806373== 
==806373== HEAP SUMMARY:
==806373==     in use at exit: 0 bytes in 0 blocks
==806373==   total heap usage: 644 allocs, 644 frees, 29,764 bytes allocated
==806373== 
==806373== All heap blocks were freed -- no leaks are possible
==806373== 
==806373== For lists of detected and suppressed errors, rerun with: -s
==806373== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
~/cs50-dev/shared/tse/indexcmp ../data/letters.index ../data/letters.indextest
# no output from indexcmp signifies equivalent file contents 

./indexer ../data/scrape ../data/scrape.index
./indextest ../data/scrape.index ../data/scrape.indextest
~/cs50-dev/shared/tse/indexcmp ../data/scrape.index ../data/scrape.indextest
# no output from indexcmp signifies equivalent file contents 

./indexer ../data/wiki ../data/wiki.index
./indextest ../data/wiki.index ../data/wiki.indextest
~/cs50-dev/shared/tse/indexcmp ../data/wiki.index ../data/wiki.indextest
# no output from indexcmp signifies equivalent file contents 


# 3. Erroneous arguments for indextest

# too few arguments (1)
./indextest
No arguments were given. The correct format is: indextest oldIndexFilename newIndexFilename

# too many arguments (6)
./indextest ../data/letters.index ../data/letters.indextest extraArg1 extraArg2 extraArg3
Too many arguments were given. The correct format is: indextest oldIndexFilename newIndexFilename

# non-readable pageDirectory
./indextest ../data/testfiles/noreaddirectory ../data/letters.indextest
Error opening oldIndexFilename with read permissions, file does not exist or is not readable.

# non-writable indexFilename
./indextest ../data/letters.index ../data/testfiles/nowriteindex
Error opening newIndexFilename with write permissions, file does not exist or is not writeable.
make: *** [Makefile:28: test] Error 1
